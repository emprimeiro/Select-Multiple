/*!
 * jQuery Select Multiple Plugin
 * Examples and documentation at: http://github.com/emprimeiro/select-multiple/
 * Version: 0.1 (17-03-2011)
 * Copyright 2011, Emprimeiro http://emprimeiro.com.br/
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * Requires IE7+
 */
jQuery.fn.extend({selectMultiple:function(d){d=jQuery.extend({select_all:true,width:null,optgroup_selectable:true,string_ok:"ok",string_cancel:"cancelar",string_select_all:"marcar todos",string_deselect_all:"demarcar todos"},d);this.hide();if(!this.attr("id")){var c=Math.floor(Math.random()*1000+1);this.attr("id","sm-"+c)}var h=document.createElement("span");$(h).addClass("select-multiple");$(h).attr("data-id",this.attr("id"));this.after(h);if(d.width){var b=d.width;var f=parseInt($(h).css("padding-left").replace("px"));var e=parseInt($(h).css("padding-right").replace("px"));b=b-(f+e);$(h).css("width",b)}$(h).click(function(){var k=$("#"+$(this).attr("data-id"));var q="";var n=k.prev();if(n.attr("nodeName")=="LABEL"){q+='<span class="select-multiple-title">'+k.prev().html()+"</span>"}q+='<input type="hidden" name="sm-select" value="'+$(this).attr("data-id")+'"/>';q+='<div id="select-multiple-content">';i=0;j=0;var m=k.find("option");if(m.length<10){columns_number=2}else{columns_number=3}var p=Math.ceil(m.length/columns_number);var l=false;var o=false;m.each(function(){i++;j++;if(l==false){q+='<div class="select-multiple-column">';l=true}o=false;if(k.attr("multiple")){$("#select-multiple-container").html('<input type="checkbox"/>')}else{$("#select-multiple-container").html('<input type="radio"/>')}var r=$("#select-multiple-container input");$(r).attr("data-name","sm-"+k.attr("name"));$(r).attr("value",$(this).val());var s="sm-"+k.attr("id")+"-"+i;$(r).attr("id",s);q+=$("#select-multiple-container").html()+'<label for="'+s+'">'+$(this).html()+"</label>";q+='<div class="select-multiple-clear"></div>';if(j==p){j=0;l=false;o=true;q+="</div>"}});if(l==true&&o==false){q+="</div>"}q+='<div class="select-multiple-clear"></div>';q+="</div>";if(k.attr("multiple")&&d.select_all){q+='<div id="select-multiple-buttons-left">';q+='<a id="select-multiple-select-all" href="javascript:void(0)">'+d.string_select_all+"</a>";q+='<a id="select-multiple-deselect-all" href="javascript:void(0)">'+d.string_deselect_all+"</a>";q+="</div>"}q+='<div id="select-multiple-buttons-right">';q+='<a id="select-multiple-save" href="javascript:void(0)">'+d.string_ok+"</a>";q+='<a id="select-multiple-cancel" href="javascript:void(0)">'+d.string_cancel+"</a>";q+="</div>";$("#select-multiple-container").html(q);$("#select-multiple-content").css("width",((columns_number*200)+20)+"px");k.find("option").each(function(){if($(this).attr("selected")){$('#select-multiple-content input[value="'+$(this).val()+'"]').attr("checked",true)}});k.find("optgroup").each(function(){var t=$(this).find("option:first-child").val();var s=$(this).find("option:last-child").val();var v="optgroup-"+t;$(this).find("option").each(function(){$("#select-multiple-content").find('input[value="'+$(this).val()+'"]').addClass(v)});var r='<span class="select-multiple-optgroup"><span>'+$(this).attr("label")+"</span></span>";var u=$("#select-multiple-content").find('input[value="'+t+'"]');$(u).before(r);$("#select-multiple-content").find('input[value="'+s+'"] + label').css({"margin-bottom":"20px"});if(d.optgroup_selectable){$(u).prev().prepend('<input type="checkbox" name="sm-optgroup" value="'+v+'"/>');$(u).prev().css("cursor","pointer")}});$('[name="sm-optgroup"]').change(function(){$("."+$(this).val()).attr("checked",$(this).attr("checked"))});$('[name="sm-optgroup"] + span').click(function(){var r=$(this).prev();$(r).attr("checked",!$(r).attr("checked"));$("."+$(r).val()).attr("checked",$(r).attr("checked"))});$("#select-multiple-content input").each(function(){$(this).attr("name",$(this).attr("data-name"))});$("#select-multiple-container").css({"margin-top":"-"+($("#select-multiple-container").height()/2)+"px","margin-left":"-"+($("#select-multiple-container").width()/2)+"px"});$("#select-multiple-cancel").click(function(){$("#select-multiple-container").hide()});$("#select-multiple-save").click(function(){var r=$("#"+$('[name="sm-select"]').val());r.find("option").removeAttr("selected");$("#select-multiple-content input:checked").each(function(){r.find('option[value="'+$(this).val()+'"]').attr("selected","selected")});g();$("#select-multiple-container").hide()});$("#select-multiple-select-all").click(function(){$("#select-multiple-content input").each(function(){$(this).attr("checked",true)})});$("#select-multiple-deselect-all").click(function(){$("#select-multiple-content input").each(function(){$(this).attr("checked",false)})});$('#select-multiple-content [type="checkbox"]').change(function(){a()});a();$("#select-multiple-container").show()});function a(){$('[name="sm-optgroup"]').each(function(){$(this).attr("checked",true);var k=this;$("(."+$(k).val()+":not(:checked)").each(function(){$(k).attr("checked",false)})})}function g(){$(h).html("");$("#"+$(h).attr("data-id")+" :selected").each(function(){$(h).append($(this).html()+", ")});var k=$(h).html();if(k.length>2){$(h).html(k.substr(0,k.length-2))}}g();if($("#select-multiple-container").length==0){$("body").append('<div id="select-multiple-container"></div>')}}});
